const validPortalKeys="0123456789ABCDEF";let galaxy;function getRegions(e){const t=["F9556C30","F9555C30","F9555C31","F9556C31","F9557C31","F9557C30","F9557C2F","F9556C2F","F9555C2F","FA556C30","F8556C30"];return"Eissentam"==e&&t.splice(-2,2,"FA556C30","FA555C30","FA555C31","FA556C31","FA557C31","FA557C30","FA557C2F","FA556C2F","FA555C2F","F8556C30","F8555C30","F8555C31","F8556C31","F8557C31","F8557C30","F8557C2F","F8556C2F","F8555C2F"),new Set(t)}function hideMain(){const e=document.getElementById("galaxyInput"),t=document.getElementById("toc"),n=document.querySelector("main");galaxy=e.value,n.style.display=galaxy?"":"none",t.style.visibility=galaxy?"":"hidden"}function getSectionId(e){return e.closest("section").id}function reset(e){const t=getSectionId(e),n=document.getElementById(t),r=n.querySelector("input"),o=n.querySelectorAll("output, .output>*"),l=n.querySelectorAll(".error");for(const e of l)e.classList.remove("error");for(const e of o)e.innerHTML="";r.value=""}function deleteCharacter(e){const t=document.getElementById(e),n=t.value.slice(0,-1);t.value=n,showGlyphs(),checkGlyphs(t)}function glyphOnClick(e){const t=document.getElementById("portalglyphsInput");t.value.length<12&&(t.value+=e.value),showGlyphs(),checkGlyphs(t)}function glyphInputOnChange(e){const t=e?.value?.toUpperCase?.();if(null==t)return;const n=t.split("").filter((e=>validPortalKeys.includes(e))).join("").substr(0,12);e.value=n,showGlyphs(),checkGlyphs(e)}function showGlyphs(){const e=document.getElementById("portalglyphsInput");document.getElementById("glyphDisplay").innerText=e.value}function submit(e){const t=getSectionId(e),n=document.querySelector(`#${t} .output`),r=n.querySelector("output"),o=n.querySelector(".status"),l={generator:()=>generateTag(),decoder:()=>decodeTag()}[t]()||{status:"",output:""},u=l.status,s=l.output,a=u.includes("Error");n.classList[a?"add":"remove"]("error"),o.innerText=u,r.innerText=s}function generateTag(){const e=document.getElementById("portalglyphsInput"),t=e.value,{isValid:n,error:r}=checkGlyphs(e,!0);if(!t)return;if(!n)return{status:"Error:",output:r};return{status:"Your Hub Tag:",output:`[HUB${getRegionNum(t)}-${getSIV(t)}]`}}function getRegionNum(e){const t=e.substring(4),n=Array.from(getRegions(galaxy)).indexOf(t);if(n>-1)return n+1}function getSIV(e){const t=e.substring(1,4),n=Number("0x"+t);if(!n||n>767)return;return n.toString(16).toUpperCase().replace("69","68+1")}function checkGlyphs(e,t=!1){const n=e.value,r=n.substring(4),o=n.substring(1,4),l=Number("0x"+o),u=getRegions(galaxy),s=12==n.length,a=u.has(r),i=l&&l<768,c=t||12==n.length?s&&a&&i:12!=n.length||void 0;if(e.classList[c?"remove":"add"]("error"),!c){if(!s)return{isValid:!1,error:"Invalid glyph sequence: Incorrect length"};if(!a)return{isValid:!1,error:"Invalid glyph sequence: No Hub region"};if(!i)return{isValid:!1,error:"Invalid glyph sequence: Not reachable via portal"}}return{isValid:!0}}function decodeTag(){const e=document.getElementById("tagInput").value.replaceAll(/[\[\]]/g,"").replaceAll("68+1","69").trim();if(!e)return;console.log(e);const t=Array.from(getRegions(galaxy)),[n,r]=e.split("-"),o=n.replace("HUB","")-1,l=t[o];if(!r||o<0||!n.startsWith("HUB")){let e;return r?(o<0||!n.startsWith("HUB"))&&(e='Invalid Hub tag format (no "HUB" or wrong region ID)'):e='Invalid Hub tag format (missing "-")',{status:"Error:",output:e}}return{status:"Glyphs:",output:"0"+r.padStart(3,"0")+l}}function switchTheme(e=null){const t=document.documentElement.dataset.theme,n=e??("dark"==t?"light":"dark");document.documentElement.dataset.theme=n}(()=>{switchTheme(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),hideMain();const e=document.querySelector(".portal-buttons");if(!e)return;const t=new Array;for(const e of validPortalKeys){const n=`<button class="button glyphs" type="button" value="${e}" onclick="glyphOnClick(this)">${e}</button>`;t.push(n)}e.innerHTML=t.join("")})();
