const validPortalKeys="0123456789ABCDEF";let galaxy;function getRegions(t){const e=["F9556C30","F9555C30","F9555C31","F9556C31","F9557C31","F9557C30","F9557C2F","F9556C2F","F9555C2F","FA556C30","F8556C30"];return"Eissentam"==t&&e.splice(-2,2,"FA556C30","FA555C30","FA555C31","FA556C31","FA557C31","FA557C30","FA557C2F","FA556C2F","FA555C2F","F8556C30","F8555C30","F8555C31","F8556C31","F8557C31","F8557C30","F8557C2F","F8556C2F","F8555C2F"),new Set(e)}function hideMain(){const t=document.getElementById("galaxyInput"),e=document.getElementById("toc"),n=document.querySelector("main");galaxy=t.value,n.style.display=galaxy?"":"none",e.style.visibility=galaxy?"":"hidden"}function getSectionId(t){return t.closest("section").id}function reset(t){const e=getSectionId(t),n=document.getElementById(e),o=n.querySelector("input"),r=n.querySelectorAll("output, .output>*");for(const t of r)t.innerHTML="";o.value=""}function deleteCharacter(t){const e=document.getElementById(t),n=e.value.slice(0,-1);e.value=n,showGlyphs(),checkGlyphs(e)}function glyphOnClick(t){const e=document.getElementById("portalglyphsInput");e.value.length<12&&(e.value+=t.value),showGlyphs(),checkGlyphs(e)}function glyphInputOnChange(t){const e=t?.value?.toUpperCase?.();if(null==e)return;const n=e.split("").filter((t=>validPortalKeys.includes(t))).join("").substr(0,12);t.value=n,showGlyphs(),checkGlyphs(t)}function showGlyphs(){const t=document.getElementById("portalglyphsInput");document.getElementById("glyphDisplay").innerText=t.value}function submit(t){const e=getSectionId(t),n=document.querySelector(`#${e} .output`),o=n.querySelector("output"),r=n.querySelector(".status"),l={generator:()=>generateTag(),decoder:()=>decodeTag()}[e]()||{status:"",output:""},u=l.status,s=l.output,a=u.includes("Error");n.style.backgroundColor=a?"red":"",r.innerText=u,o.innerText=s}function generateTag(){const t=document.getElementById("portalglyphsInput"),e=t.value,{valid:n,error:o}=checkGlyphs(t,!0);if(!e)return;if(!n)return{status:"Error:",output:o};return{status:"Your Hub Tag:",output:`[HUB${getRegionNum(e)}-${getSIV(e)}]`}}function getRegionNum(t){const e=t.substring(4),n=Array.from(getRegions(galaxy)).indexOf(e);if(n>-1)return n+1}function getSIV(t){const e=t.substring(1,4),n=Number("0x"+e);if(!n||n>767)return;return n.toString(16).toUpperCase().replace("69","68+1")}function checkGlyphs(t,e=!1){const n=t.value,o=n.substring(4),r=n.substring(1,4),l=Number("0x"+r),u=getRegions(galaxy),s=!e||12==n.length,a=u.has(o)||12!=n.length,c=l&&l<768,i=s&&a&&c||!n.length;if(t.style.backgroundColor=i?"":"lightcoral",!i){if(!s)return{valid:!1,error:"Invalid glyph sequence: Incorrect length"};if(!a)return{valid:!1,error:"Invalid glyph sequence: No Hub region"};if(!c)return{valid:!1,error:"Invalid glyph sequence: Not reachable via portal"}}return{valid:!0}}function decodeTag(){const t=document.getElementById("tagInput").value.replaceAll(/[\[\]]/g,"").replaceAll("68+1","69").trim();if(!t)return;console.log(t);const e=Array.from(getRegions(galaxy)),[n,o]=t.split("-"),r=n.replace("HUB","")-1,l=e[r];if(!o||r<0||!n.startsWith("HUB")){let t;return o?(r<0||!n.startsWith("HUB"))&&(t='Invalid Hub tag format (no "HUB" or wrong region ID)'):t='Invalid Hub tag format (missing "-")',{status:"Error:",output:t}}return{status:"Glyphs:",output:"0"+o.padStart(3,"0")+l}}function switchTheme(t=null){const e=document.documentElement.dataset.theme,n=t??("dark"==e?"light":"dark");document.documentElement.dataset.theme=n}(()=>{switchTheme(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),hideMain();const t=document.querySelector(".portal-buttons");if(!t)return;const e=new Array;for(const t of validPortalKeys){const n=`<button class="button glyphs" type="button" value="${t}" onclick="glyphOnClick(this)">${t}</button>`;e.push(n)}t.innerHTML=e.join("")})();
